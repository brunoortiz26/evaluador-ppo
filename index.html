<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Evaluador de PPO</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Evaluador de PPO con IA</h1>
        
        <div class="card">
            <h2>1. Cargar Documentos</h2>
            <input type="file" id="archivoPrincipal">
        </div>

        <div class="card">
            <h2>2. Configuración</h2>
            <label>Claridad: <input type="range" id="c1" min="1" max="10" value="8" oninput="v1.innerText=this.value"> <span id="v1">8</span></label><br>
            <label>Viabilidad: <input type="range" id="c2" min="1" max="10" value="10" oninput="v2.innerText=this.value"> <span id="v2">10</span></label><br>
            <label>Normativa: <input type="range" id="c3" min="1" max="10" value="9" oninput="v3.innerText=this.value"> <span id="v3">9</span></label>
        </div>

        <button id="btn">Evaluar PPO</button>
        <div id="resultado" style="margin-top:20px; white-space: pre-wrap; border: 1px solid #ccc; padding: 10px;"></div>
    </div>

    <script>
        document.getElementById('btn').onclick = async () => {
            const file = document.getElementById('archivoPrincipal').files[0];
            if (!file) return alert("Subí un archivo");
            
            const res = document.getElementById('resultado');
            res.innerText = "⏳ Conectando con Gemini... por favor esperá.";

            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async () => {
                const base64 = reader.result.split(',')[1];
                try {
                    const response = await fetch('/.netlify/functions/gemini', {
                        method: 'POST',
                        body: JSON.stringify({ 
                            file: base64, 
                            name: file.name,
                            p1: document.getElementById('c1').value,
                            p2: document.getElementById('c2').value,
                            p3: document.getElementById('c3').value
                        })
                    });
                    const data = await response.json();
                    res.innerText = data.mensaje || "Error: " + JSON.stringify(data);
                } catch (e) {
                    res.innerText = "Error de conexión. Revisá la consola.";
                }
            };
        };
    </script>
</body>
</html>